<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Новый заголовок и описание -->
  <title>Кэшбэкиус – Лучшие предложения от банков и магазинов</title>
  <meta name="description" content="Кэшбэк акции от банков и магазинов: лучшие предложения на одной странице. Подписывайтесь, чтобы не пропустить!">

  <!-- Favicon -->
  <link rel="icon" href="https://emmablossom.github.io/new/favicon.ico" type="image/x-icon">

  <!-- Open Graph для соцсетей -->
  <meta property="og:title" content="Кэшбэк Акции – Лучшие предложения от банков">
  <meta property="og:description" content="Сравнивайте кэшбэк акции и экономьте больше. Обновления каждый день!">
  <meta property="og:image" content="https://emmablossom.github.io/new/share-image-fixed.jpg">
  <meta property="og:url" content="https://emmablossom.github.io/new/">
  <meta property="og:type" content="website">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Кэшбэк Акции – Лучшие предложения от банков">
  <meta name="twitter:description" content="Сравнивайте кэшбэк акции и экономьте больше.">
  <meta name="twitter:image" content="https://emmablossom.github.io/new/share-image-fixed.jpg">

    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --background-color: #ecf0f1;
            --card-background: #ffffff;
            --text-color: #333333;
            --light-gray: #bdc3c7;
            --border-radius: 8px;
            --box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* --- header updates: logo on the left + site name --- */
        header {
            background-color: var(--secondary-color);
            color: #ffffff;
            padding: 20px;
            display: flex;               /* line up logo + title */
            align-items: center;
            justify-content: flex-start;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            margin-bottom: 20px;
        }

        .site-logo {
            height: 40px;                /* controls logo size */
            width: auto;
            margin-right: 12px;
        }

        header h1 {
            margin: 0;
            font-size: 2em;              /* slightly smaller to fit with logo */
        }

        .filters {
            background: var(--card-background);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            align-items: end;
        }

        .filter-group, .search-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label, .search-group label {
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--secondary-color);
        }

        .filter-group select, .search-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-size: 1em;
        }
        
        .bank-filter {
            grid-column: 1 / -1;
        }

        .bank-checkboxes {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 5px;
        }

        .bank-checkboxes label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: normal;
        }
        
        .bank-checkboxes input {
            margin-right: 5px;
        }
        
        #reset-filters {
            padding: 10px 20px;
            border: none;
            background-color: var(--primary-color);
            color: white;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s;
            height: 42px;
        }

        #reset-filters:hover {
            background-color: #2980b9;
        }
        
        #initial-message {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-size: 1.2em;
        }

        #cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .flash-effect {
            animation: flash 0.7s ease-out;
        }

        @keyframes flash {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 1; }
        }

        .card {
            background: var(--card-background);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        
        .card-content p {
            margin: 0 0 10px;
            word-wrap: break-word;
        }

        .card-content p:first-child { font-weight: bold; color: var(--primary-color); }
        .card-content p:nth-child(2) { font-size: 1.1em; font-weight: 500; }
        .card-content p:nth-child(3) { font-size: 1.2em; font-weight: bold; color: #27ae60; }
        .card-content p:last-child { color: #7f8c8d; font-size: 0.9em; margin-bottom: 0; }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: var(--card-background);
            margin: 5% auto;
            padding: 30px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 700px;
            position: relative;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to   { opacity: 1; transform: scale(1); }
        }

        .modal-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .back-arrow {
            font-size: 2em;
            font-weight: bold;
            cursor: pointer;
            margin-right: 20px;
            color: var(--primary-color);
        }
        
        .modal-header h2 {
            margin: 0;
            font-size: 1.8em;
            color: var(--secondary-color);
        }
        
        .modal-body p {
            margin: 0 0 15px;
        }
        
        .modal-body strong {
            color: var(--secondary-color);
            display: block;
            margin-bottom: 5px;
        }
        
        .modal-body a {
            color: var(--primary-color);
            text-decoration: none;
        }
        
        .modal-body a:hover {
            text-decoration: underline;
        }
        
        /* --- правка: фикс цвета текста на кнопке --- */
        .modal-body .open-card-btn { color: #fff; }

        .modal-body .how-to {
            white-space: pre-wrap;
        }
        
        @media (max-width: 768px) {
            header h1 {
                font-size: 1.6em;           /* reduce slightly on mobile */
            }
            .filters {
                grid-template-columns: 1fr;
            }
        }

        /* --- intro section --- */
        .intro-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--card-background);
            padding: 30px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .intro-text {
            flex: 1 1 300px;
            max-width: 600px;
        }

        .intro-text h2 {
            font-size: 2em;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .intro-text p {
            font-size: 1.1em;
            margin-bottom: 20px;
        }

        .tg-button {
            display: inline-block;
            background-color: #0088cc;
            color: white;
            padding: 12px 24px;
            border-radius: var(--border-radius);
            text-decoration: none;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .tg-button:hover {
            background-color: #007ab8;
        }

        .intro-image {
            flex: 1 1 300px;
            text-align: center;
        }

        /* --- image changes: remove framing & 50% size --- */
        .intro-image img {
            width: 50%;            /* half of original size */
            max-width: 50%;
            height: auto;
            border-radius: 0;      /* no rounded corners */
            box-shadow: none;      /* no shadow/border */
        }

        /* Мобильная адаптация */
        @media (max-width: 768px) {
            .intro-section {
                flex-direction: column;
                text-align: center;
            }

            .intro-text h2 {
                font-size: 1.6em;
            }

            .intro-text p {
                font-size: 1em;
            }

            .tg-button {
                width: 100%;
                padding: 14px;
                font-size: 1em;
            }
            /* make image full width on mobile for better view */
            .intro-image img { width: 100%; max-width: 100%; }
        }

        /* ▼ стиль для кнопки в модальном окне ▼ */
        .open-card-btn{
          display:inline-block;
          background-color:var(--primary-color);
          color:#fff;
          padding:12px 24px;
          border-radius:var(--border-radius);
          text-decoration:none;
          font-weight:bold;
          transition:background-color .3s;
        }
        .open-card-btn:hover{background-color:#2980b9;}
        /* ▲ конец вставки ▲ */
    </style>

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript" >
       (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
       m[i].l=1*new Date();
       for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
       k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
       (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

       ym(102716660, "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true,
            webvisor:true
       });
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/102716660" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->

</head>
<body>

    <div class="container">
        <header>
            <!-- Логотип размещён слева -->
            <img src="logo.png" alt="Логотип Кэшбэкиус" class="site-logo">
            <h1>Кэшбэкиус</h1>
        </header>

        <div class="intro-section">
          <div class="intro-text">
            <p>
              Ваш гид по самым выгодным кэшбэк-акциям!<br>
              Публикуем свежие предложения от разных банков, чтобы вы экономили больше каждый день.
            </p>
            <a class="tg-button" href="https://t.me/cashbackius" target="_blank">Подписаться на телеграм канал</a>
          </div>
          <div class="intro-image">
            <img src="https://raw.githubusercontent.com/EmmaBlossom/new/main/image.png" alt="Cashback" />
          </div>
        </div>

            <div class="filters">
            <div class="filter-group">
                <label for="category-filter">Категория</label>
                <select id="category-filter">
                    <option value="">Все</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="brand-filter">Бренд</label>
                <select id="brand-filter">
                    <option value="">Все</option>
                </select>
            </div>
             <div class="filter-group">
                <label for="cashback-filter">Размер кэшбэка</label>
                <select id="cashback-filter">
                    <option value="">Все</option>
                </select>
            </div>
            <div class="search-group">
                <label for="search">Поиск</label>
                <input type="text" id="search" placeholder="Поиск по всем полям...">
            </div>
            <div class="bank-filter">
                <label>Банк</label>
                <div id="bank-filter-checkboxes" class="bank-checkboxes">
                </div>
            </div>
            
            <div class="filter-group">
                <button id="reset-filters">Сбросить все фильтры</button>
            </div>
        </div>

        <div id="initial-message">
            <p>Выберите фильтр, чтобы увидеть акции</p>
        </div>
        <div id="cards-container">
        </div>
    </div>
    
    <div id="details-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="back-arrow" onclick="closeModal()">&#8592;</span>
                <h2 id="modal-brand"></h2>
            </div>
            <div class="modal-body">
                <p><strong>Банк:</strong> <span id="modal-bank"></span></p>
                <p><strong>Карта:</strong> <span id="modal-card"></span></p>
                <p><strong>Категория:</strong> <span id="modal-category"></span></p>
                <p><strong>Размер кэшбэка/скидки:</strong> <span id="modal-cashback-size"></span></p>
                <p><strong>Условия:</strong> <span id="modal-conditions"></span></p>
                <p><strong>Даты проведения акции:</strong> <span id="modal-dates"></span></p>
                <p><strong>Промокод:</strong> <span id="modal-promocode"></span></p>
                <p><strong>Макс. кэшбэк/скидка в руб:</strong> <span id="modal-max-cashback"></span></p>
                <p><strong>Дополнительная информация:</strong> <span id="modal-additional-info"></span></p>
                <p><strong>О партнере:</strong> <span id="modal-about-partner"></span></p>
                <p><strong>Сайт:</strong> <a id="modal-site" href="#" target="_blank" rel="noopener noreferrer"></a></p>
                <p><strong>Как получить кэшбэк:</strong> <span id="modal-how-to" class="how-to"></span></p>
                <!-- ▼ вставили кнопку-ссылку ▼ -->
<p style="text-align:center; margin-top:25px;">
  <a id="open-card-btn" class="open-card-btn"
     href="#"
     target="_blank" rel="noopener noreferrer"
     style="display:none;"> <!-- скрыта по умолчанию -->
     Открыть карту банка и получить бонусные рубли
  </a>
</p>
<!-- ▲ конец вставки ▲ -->
            </div>
        </div>
    </div>

    <script>
        const jsonData = [
  {
    "Банк": "Альфа-Банк",
    "Карта": "Альфа Карта",
    "Категория": "Продукты",
    "Компания/бренд": "Деливери",
    "Размер кэшбека/скидки": "Скидка до 15%",
    "Условия (если указаны)": "На заказы в сервисе до 30.06.2025",
    "Короткое описание компании/бренда": "Сервис доставки",
    "Промокод (если указан)": "",
    "Даты проведения акции": "02.06.2025 - 30.06.2025",
    "Как получить кэшбэк": "Оплачивайте заказы в сервисе партнёра\nКартой Альфа-Банка\nРазмер скидки указывается в корзине\nВ сервисе Деливери\nСкидка применится автоматически\nНа стоимость заказа без учёта стоимости доставки и сервисного сбора",
    "Дополнительная информация (если есть)": "Минимальная сумма заказа — 1500 ₽",
    "Макс. кэшбек/скидка в руб": "300 ₽",
    "Сайт": "https://market-delivery.yandex.ru/",
    "О партнере": "Деливери — сервис быстрой доставки всего необходимого на каждый день. Заказывайте продукты из магазинов, товары из аптек, бытовую химию, зоотовары, косметику и товары для детей в одном приложении."
  },
  {
    "Банк": "Альфа-Банк",
    "Карта": "Альфа Карта",
    "Категория": "Продукты",
    "Компания/бренд": "Купер",
    "Размер кэшбека/скидки": "Кэшбэк до 20%",
    "Условия (если указаны)": "На первую покупку до 30.06.2025",
    "Короткое описание компании/бренда": "Маркетплейс",
    "Промокод (если указан)": "",
    "Даты проведения акции": "01.06.2025 - 30.06.2025",
    "Как получить кэшбэк": "Оплатите первую покупку в маркетплейсе партнёра\nКартой Альфа-Банка\nЖдите кэшбэк\nОн придёт 10 числа следующего месяца",
    "Дополнительная информация (если есть)": "",
    "Макс. кэшбек/скидка в руб": "200 ₽",
    "Сайт": "https://kuper.ru/",
    "О партнере": "Купер — не просто доставка из любимых магазинов и ресторанов, это универсальный помощник"
  },
  {
    "Банк": "Альфа-Банк",
    "Карта": "Альфа Карта",
    "Категория": "Продукты",
    "Компания/бренд": "Пятёрочка Доставка",
    "Размер кэшбека/скидки": "Кэшбэк до 10%",
    "Условия (если указаны)": "На первую покупку до 31.07.2025",
    "Короткое описание компании/бренда": "Доставка любимых товаров",
    "Промокод (если указан)": "",
    "Даты проведения акции": "01.06.2025 - 31.07.2025",
    "Как получить кэшбэк": "Оплатите первый заказ от 1500 ₽ в мобильном приложении партнёра\nКартой Альфа-Банка\nЖдите кэшбэк\nОн придёт 10 числа следующего месяца",
    "Дополнительная информация (если есть)": "",
    "Макс. кэшбек/скидка в руб": "500 ₽",
    "Сайт": "https://5ka.ru/",
    "О партнере": "Пятёрочка Доставка — это быстрая доставка любимых товаров домой или в офис — от 30 минут и всего за 1 ₽. Заказывайте готовую еду, свежие продукты, всё для дома, животных и для любого повода."
  },
  {
    "Банк": "ВТБ",
    "Карта": "Дебетовая карта для жизни",
    "Категория": "Авто",
    "Компания/бренд": "Автомаг",
    "Размер кэшбека/скидки": "Кэшбэк 10%",
    "Условия (если указаны)": "Только для первой покупки; не учитываются платежи через СБП",
    "Короткое описание компании/бренда": "Сеть магазинов автотоваров в Москве и Санкт-Петербурге",
    "Промокод (если указан)": "—",
    "Даты проведения акции": "01.04.2025 – 31.07.2025 (покупка для участия — до 30.06.2025)",
    "Как получить кэшбэк": "Совершите первую покупку в магазине или на сайте Автомаг, оплатив Картой ВТБ; кэшбэк начисляется в виде бонусных рублей",
    "Дополнительная информация (если есть)": "Участник не должен быть зарегистрирован на сайте или в программе лояльности Автомаг, и не должен совершать покупки в Автомаг с 01.04.2024 по 31.03.2025",
    "Макс. кэшбек/скидка в руб": "5 000 ₽",
    "Сайт": "https://www.amag.ru/ и https://amagspb.ru",
    "О партнере": "ООО «Автохимия-Инвест» — сеть магазинов автотоваров под брендом Автомаг в Москве, Санкт-Петербурге и онлайн"
  },
  {
    "Банк": "ВТБ",
    "Карта": "Дебетовая карта для жизни",
    "Категория": "Авто",
    "Компания/бренд": "FIT SERVICE",
    "Размер кэшбека/скидки": "Кэшбэк 3%",
    "Условия (если указаны)": "Только для первой оплаты услуг в FIT SERVICE",
    "Короткое описание компании/бренда": "Федеральная сеть автосервисов по техническому обслуживанию и ремонту автомобилей",
    "Промокод (если указан)": "—",
    "Даты проведения акции": "01.04.2025 – 31.07.2025 (оплата для участия — до 30.06.2025)",
    "Как получить кэшбэк": "Оплатите услуги в любом сервисе FIT SERVICE Картой ВТБ при первом визите; кэшбэк начисляется в виде бонусных рублей",
    "Дополнительная информация (если есть)": "Участвуют только те, кто ранее не оплачивал услуги FIT SERVICE",
    "Макс. кэшбек/скидка в руб": "1 000 ₽",
    "Сайт": "https://fitauto.ru/",
    "О партнере": "ООО «ФИТ Автосервис» — российская сеть сервисных станций, представленных по всей стране"
  },
  {
    "Банк": "ВТБ",
    "Карта": "Дебетовая карта для жизни",
    "Категория": "Услуги и сервисы",
    "Компания/бренд": "Грузовичкоф",
    "Размер кэшбека/скидки": "Кэшбэк 10%",
    "Условия (если указаны)": "Начисляется с каждой операции, но не более 500 бонусных рублей за весь период",
    "Короткое описание компании/бренда": "Сервис грузоперевозок и услуг по логистике, доступный через сайт и мобильное приложение",
    "Промокод (если указан)": "—",
    "Даты проведения акции": "01.04.2025 – 31.07.2025 (оплата для участия — до 30.06.2025)",
    "Как получить кэшбэк": "Оплатите услуги сервиса «Грузовичкоф» через сайт или приложение Картой ВТБ; бонусы начисляются автоматически",
    "Дополнительная информация (если есть)": "Ограничение: бонусы начисляются на общую сумму не более 500 ₽ за весь период",
    "Макс. кэшбек/скидка в руб": "500 ₽",
    "Сайт": "http://msk.gruzovichkof.ru",
    "О партнере": "ООО «Автофлот-Столица» — оператор сервиса «Грузовичкоф» по перевозке грузов и логистическим услугам"
  },
    {
    "Банк": "Т-Банк",
    "Карта": "Black",
    "Категория": "Продукты",
    "Компания/бренд": "Винлаб",
    "Размер кэшбека/скидки": "Скидка 6%",
    "Условия (если указаны)": "Промокод действует на оплату одного заказа картой Т‑Банк и дает скидку 6% на один заказ на сайте или в приложении партнера. Максимальная скидка 3000 рублей.\n\nСкидка суммируется с желтым и фиолетовым ценником и не суммируется с другими купонами, персональными ценами, а также с акциями «ШОК-цена на товар дня», «Вместе выгодно» и не распространяется на товары, участвующие в акции «3 по цене 2». Скидка применяется только в части стоимости товаров Партнера, при условии, что цена товаров с учетом скидки не будет ниже минимальной розничной цены.",
    "Короткое описание компании/бренда": "Супермаркет напитков и продуктов",
    "Промокод (если указан)": "SSL-7CGN-MGXM-N3SH",
    "Даты проведения акции": "До 30 июня",
    "Как получить кэшбэк": "Оформите заказ на сайте партнера или в приложении и введите промокод - Выберите магазин, откуда удобно забрать заказ - Оплатите покупку любой картой Т‑Банка в выбранном магазине",
    "Дополнительная информация (если есть)": "Промокод действует на оплату одного заказа картой Т‑Банк и дает скидку 6% на один заказ на сайте или в приложении партнера. Максимальная скидка 3000 рублей.\n\nСкидка суммируется с желтым и фиолетовым ценником и не суммируется с другими купонами, персональными ценами, а также с акциями «ШОК-цена на товар дня», «Вместе выгодно» и не распространяется на товары, участвующие в акции «3 по цене 2». Скидка применяется только в части стоимости товаров Партнера, при условии, что цена товаров с учетом скидки не будет ниже минимальной розничной цены.",
    "Макс. кэшбек/скидка в руб": "Максимальная скидка — 3000 ₽",
    "Сайт": "https://winelab.page.link/2MDp",
    "О партнере": "Винлаб — супермаркет напитков и продуктов. Ассортимент — более 5000 позиций."
  },
  {
    "Банк": "Т-Банк",
    "Карта": "Black",
    "Категория": "Продукты",
    "Компания/бренд": "Яндекс Маркет",
    "Размер кэшбека/скидки": "Скидка 600 ₽",
    "Условия (если указаны)": "Промокод действует при оплате картой Т‑Банка и дает скидку 600 рублей на первую покупку от 1500 рублей на сайте или в приложении Партнера.\n\nАкция действует только для новых клиентов партнера.\n\nСкидка действует от текущей цены и не суммируется с другими промокодами.",
    "Короткое описание компании/бренда": "Маркетплейс от Яндекса",
    "Промокод (если указан)": "VXY4FA8X",
    "Даты проведения акции": "С 27 мая по 11 июня",
    "Как получить кэшбэк": "Оформите заказ на сумму от 1500 ₽ на сайте или в приложении партнера - Перед оплатой введите промокод - Оплатите покупку любой картой Т‑Банка на сайте или в приложении партнера",
    "Дополнительная информация (если есть)": "Промокод действует при оплате картой Т‑Банка и дает скидку 600 рублей на первую покупку от 1500 рублей на сайте или в приложении Партнера.\n\nАкция действует только для новых клиентов партнера.\n\nСкидка действует от текущей цены и не суммируется с другими промокодами.",
    "Макс. кэшбек/скидка в руб": "Скидка 600 ₽",
    "Сайт": "https://nquw.adj.st/?adj_t=iij3c6b&adj_campaign=Partnerka_Tbank",
    "О партнере": "Яндекс Маркет — маркетплейс от Яндекса: миллионы товаров, возможность сравнить их между собой, а также отзывы от реальных покупателей."
  },
  {
    "Банк": "Т-Банк",
    "Карта": "Black",
    "Категория": "Продукты",
    "Компания/бренд": "Перекрёсток",
    "Размер кэшбека/скидки": "Кэшбэк 30%",
    "Условия (если указаны)": "Акция не распространяется на раздел Vprok.ru.\n\nНе суммируется с другими акциями Партнера в разделе «Кэшбэк и бонусы».",
    "Короткое описание компании/бренда": "Доставка из Перекрёстка за 60 минут",
    "Промокод (если указан)": "",
    "Даты проведения акции": "С 1 по 11 июня",
    "Как получить кэшбэк": "Выберите что-нибудь на сумму от 1500 ₽ - Оплатите покупку любой картой Т‑Банка в приложении партнера - Кэшбэк придет в дату следующей выписки",
    "Дополнительная информация (если есть)": "Акция не распространяется на раздел Vprok.ru.\n\nНе суммируется с другими акциями Партнера в разделе «Кэшбэк и бонусы»",
    "Макс. кэшбек/скидка в руб": "Максимум — 600 бонусов",
    "Сайт": "https://app.perekrestok.ru/AEfu/55efbde5",
    "О партнере": "Экспресс-доставка «Перекрёстка» — это сервис доставки продуктов за 60 минут. Продукты, косметика, бытовая химия, товары для детей, дома и ремонта, а также многое другое."
  }
            ];

        const cardsContainer = document.getElementById('cards-container');
        const initialMessage = document.getElementById('initial-message');
        const searchInput = document.getElementById('search');
        const bankCheckboxesContainer = document.getElementById('bank-filter-checkboxes');
        const categoryFilter = document.getElementById('category-filter');
        const brandFilter = document.getElementById('brand-filter');
        const cashbackFilter = document.getElementById('cashback-filter');
        const resetBtn = document.getElementById('reset-filters');
        const modal = document.getElementById('details-modal');
/* ▼ ссылки для кнопки «Открыть карту…» ▼ */
const bankLinks = {
  "Альфа-Банк": "https://alfa.me/4Zz28B",
  "ВТБ":        "https://vtb.ru/l/ab0138h7",
  "Т-Банк":     "http://www.tbank.ru/baf/AUDLSGhqV4u"
};
/* ▲ конец вставки ▲ */
        let currentFilters = {
            search: '',
            banks: [],
            category: '',
            brand: '',
            cashback: ''
        };
        let hasFiltered = false;

        function displayCards(data) {
            cardsContainer.innerHTML = '';
            cardsContainer.classList.remove('flash-effect');

            if (!hasFiltered) {
                initialMessage.style.display = 'block';
                return;
            }
            
            initialMessage.style.display = 'none';

            if (data.length > 0) {
                data.forEach((item) => {
                    const card = document.createElement('div');
                    card.classList.add('card');
                    card.innerHTML = `
    <div class="card-content">
        <img src="${getBankLogo(item['Банк'])}" alt="${item['Банк']}" style="height: 30px; margin-bottom: 10px;">
        <p>${item['Компания/бренд']}</p>
        <p>${item['Размер кэшбека/скидки']}</p>
        <p>${item['Даты проведения акции']}</p>
    </div>
`;
                    card.addEventListener('click', () => showDetails(item));
                    cardsContainer.appendChild(card);
                });
            } else {
                 cardsContainer.innerHTML = '<p style="text-align: center; grid-column: 1 / -1; color: #7f8c8d;">Нет акций, соответствующих вашим критериям.</p>';
            }
             void cardsContainer.offsetWidth; // Trigger reflow to restart animation
            cardsContainer.classList.add('flash-effect');
        }

        function populateSelect(selectElement, options, selectedValue = '') {
            const currentValue = selectElement.value;
            selectElement.innerHTML = '<option value="">Все</option>';

            const isCategoryClick = selectElement.id === 'category-filter' && selectElement.dataset.clicked === 'true';

            options.forEach(option => {
                const opt = document.createElement('option');
                opt.value = option;
                opt.textContent = option;
                
                if (isCategoryClick && option === selectedValue) {
                   opt.style.fontWeight = 'bold';
                }
                selectElement.appendChild(opt);
            });
            selectElement.value = selectedValue || currentValue;
        }

        function populateAllFilters(data) {
            const banks = [...new Set(data.map(item => item['Банк']))].sort();
            const categories = [...new Set(data.map(item => item['Категория']))].sort();
            const brands = [...new Set(data.map(item => item['Компания/бренд']))].sort();
            const cashbacks = [...new Set(data.map(item => item['Размер кэшбека/скидки']))].sort();

            bankCheckboxesContainer.innerHTML = banks.map(bank => `
                <label>
                    <input type="checkbox" name="bank" value="${bank}"> ${bank}
                </label>
            `).join('');
            
            populateSelect(categoryFilter, categories);
            populateSelect(brandFilter, brands);
            populateSelect(cashbackFilter, cashbacks);
        }

        function applyFilters() {
            let filteredData = [...jsonData];
            
            const searchActive = currentFilters.search !== '';
            const banksActive = currentFilters.banks.length > 0;
            const categoryActive = currentFilters.category !== '';
            const brandActive = currentFilters.brand !== '';
            const cashbackActive = currentFilters.cashback !== '';

            hasFiltered = searchActive || banksActive || categoryActive || brandActive || cashbackActive;

            if (banksActive) {
                filteredData = filteredData.filter(item => currentFilters.banks.includes(item['Банк']));
            }
            if (categoryActive) {
                filteredData = filteredData.filter(item => item['Категория'] === currentFilters.category);
            }
            if (brandActive) {
                filteredData = filteredData.filter(item => item['Компания/бренд'] === currentFilters.brand);
            }
            if (cashbackActive) {
                filteredData = filteredData.filter(item => item['Размер кэшбека/скидки'] === currentFilters.cashback);
            }

            // Update dependent filters BEFORE search filtering
            updateDependentFilters(filteredData);
            
            if (searchActive) {
                const searchTerm = currentFilters.search.toLowerCase();
                filteredData = filteredData.filter(item =>
                    Object.values(item).some(val =>
                        String(val).toLowerCase().includes(searchTerm)
                    )
                );
            }
            
            displayCards(filteredData);
        }

        function updateDependentFilters(data) {
            const availableCategories = [...new Set(data.map(item => item['Категория']))].sort();
            const availableBrands = [...new Set(data.map(item => item['Компания/бренд']))].sort();
            const availableCashbacks = [...new Set(data.map(item => item['Размер кэшбека/скидки']))].sort();

            populateSelect(categoryFilter, availableCategories, currentFilters.category);
            populateSelect(brandFilter, availableBrands, currentFilters.brand);
            populateSelect(cashbackFilter, availableCashbacks, currentFilters.cashback);
        }

        function handleFilterChange() {
            currentFilters.search = searchInput.value;
            currentFilters.category = categoryFilter.value;
            currentFilters.brand = brandFilter.value;
            currentFilters.cashback = cashbackFilter.value;
            currentFilters.banks = Array.from(document.querySelectorAll('input[name="bank"]:checked')).map(cb => cb.value);
            
            applyFilters();
        }

        function resetFilters() {
            hasFiltered = false;
            currentFilters = { search: '', banks: [], category: '', brand: '', cashback: '' };
            
            searchInput.value = '';
            document.querySelectorAll('input[name="bank"]:checked').forEach(cb => cb.checked = false);
             
            categoryFilter.value = '';
            brandFilter.value = '';
            cashbackFilter.value = '';
            
            populateAllFilters(jsonData);
            displayCards([]);
        }
        
        function getBankLogo(bankName) {
    const map = {
        "Альфа-Банк": "alfa-bank.png",
        "ВТБ": "vtb.png",
        "Т-Банк": "t-bank.png"
        // Добавьте другие банки по мере необходимости
    };
    return map[bankName] || "logos/default.png";
}
        
        function showDetails(item) {
            document.getElementById('modal-brand').textContent = item['Компания/бренд'] || 'Нет данных';
            document.getElementById('modal-bank').textContent = item['Банк'] || 'Нет данных';
            document.getElementById('modal-card').textContent = item['Карта'] || 'Нет данных';
            document.getElementById('modal-category').textContent = item['Категория'] || 'Нет данных';
            document.getElementById('modal-cashback-size').textContent = item['Размер кэшбека/скидки'] || 'Нет данных';
            document.getElementById('modal-conditions').textContent = item['Условия (если указаны)'] || 'Нет данных';
            document.getElementById('modal-dates').textContent = item['Даты проведения акции'] || 'Нет данных';
            document.getElementById('modal-promocode').textContent = item['Промокод (если указан)'] || 'Не требуется';
            document.getElementById('modal-max-cashback').textContent = item['Макс. кэшбек/скидка в руб'] || 'Нет данных';
            document.getElementById('modal-additional-info').textContent = item['Дополнительная информация (если есть)'] || 'Нет';
            document.getElementById('modal-about-partner').textContent = item['О партнере'] || 'Нет данных';
            document.getElementById('modal-how-to').textContent = item['Как получить кэшбэк'] || 'Нет данных';
            
            const siteLink = document.getElementById('modal-site');
            if(item['Сайт']) {
                siteLink.href = item['Сайт'];
                siteLink.textContent = item['Сайт'];
                siteLink.parentElement.style.display = 'block';
            } else {
                siteLink.parentElement.style.display = 'none';
            }
            /* ▼ логика кнопки «Открыть карту…» ▼ */
const openCardBtn = document.getElementById('open-card-btn');
const bankLink = bankLinks[item['Банк']];      // ищем ссылку по банку

if (bankLink) {                                // если ссылка найдена
  openCardBtn.href = bankLink;
  openCardBtn.style.display = 'inline-block';  // показать кнопку
} else {
  openCardBtn.style.display = 'none';          // скрыть, если банк не в списке
}
/* ▲ конец вставки ▲ */
            modal.style.display = 'block';
        }

        function closeModal() {
            modal.style.display = 'none';
        }
        
        // --- Event Listeners ---
        
        searchInput.addEventListener('input', handleFilterChange);
        bankCheckboxesContainer.addEventListener('change', handleFilterChange);
        categoryFilter.addEventListener('change', handleFilterChange);
        brandFilter.addEventListener('change', handleFilterChange);
        cashbackFilter.addEventListener('change', handleFilterChange);
        resetBtn.addEventListener('click', resetFilters);
        
        // Special logic for category filter click
        categoryFilter.addEventListener('mousedown', () => {
            if (categoryFilter.value !== '') {
                const selectedValue = categoryFilter.value;
                const allCategories = [...new Set(jsonData.map(item => item['Категория']))].sort();
                categoryFilter.dataset.clicked = 'true';
                populateSelect(categoryFilter, allCategories, selectedValue);
            }
        });
        /*
        categoryFilter.addEventListener('blur', () => {
             categoryFilter.dataset.clicked = 'false';
             applyFilters(); // Re-apply smart filters when dropdown is closed
        });
        */

        window.addEventListener('click', (event) => {
            if (event.target == modal) {
                closeModal();
            }
        });
        
        // --- Initial Load ---
        populateAllFilters(jsonData);
        displayCards([]);

    </script>

<style>
  /* Стили для модального окна */
  #popupOverlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    display: none;
    z-index: 1000;
  }

  #popupBox {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #ffffff;
    border-radius: 12px;
    padding: 30px;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    text-align: center;
    z-index: 1001;
  }

  #popupBox h2 {
    margin-bottom: 15px;
    font-size: 20px;
    color: #333;
  }

  #popupBox a {
    display: inline-block;
    margin-top: 10px;
    padding: 10px 20px;
    background-color: #0088cc;
    color: #fff;
    text-decoration: none;
    border-radius: 8px;
    font-weight: bold;
  }

  #popupBox button {
    margin-top: 15px;
    background: none;
    border: none;
    color: #888;
    cursor: pointer;
    font-size: 14px;
  }

  #popupBox button:hover {
    color: #000;
  }
</style>

<div id="popupOverlay">
  <div id="popupBox">
    <h2>Подпишитесь на наш Телеграм канал,<br>чтобы видеть самые интересные предложения и новости про обновление сайта</h2>
    <a href="https://t.me/cashbackius" target="_blank">Перейти в Telegram</a>
    <br>
    <button onclick="document.getElementById('popupOverlay').style.display='none'">Закрыть</button>
  </div>
</div>

<script>
  if (!localStorage.getItem('popupShown')) {
    setTimeout(function () {
      document.getElementById('popupOverlay').style.display = 'block';
      localStorage.setItem('popupShown', 'true');
    }, 60000); // 1 минута = 60000 мс
  }
</script>


</body>
</html>
